# Меры безопасности

## Обзор

Система включает комплексные меры безопасности для защиты от вредоносных файлов, стилеров, троянов и других угроз.

## Проверка .session файлов

### Проверки размера
- Минимальный размер: 1 KB
- Максимальный размер: 100 KB
- Файлы вне этого диапазона отклоняются

### Проверка структуры
- Проверка на исполняемые файлы (PE, ELF)
- Проверка на Python байт-код
- Проверка на текстовые скрипты

### Проверка содержимого
- Сканирование на подозрительные паттерны:
  - Стилеры (stealer, keylogger, password, wallet, crypto, etc.)
  - Трояны (backdoor, trojan, virus, malware, exploit)
  - Подозрительные URL и IP адреса
  - Опасные команды (exec, eval, subprocess, os.system)

### Хеширование
- Каждый загруженный .session файл хешируется (SHA-256)
- Хеш логируется для отслеживания

## Проверка .txt файлов

### Проверки размера
- Максимальный размер: 10 MB

### Проверка содержимого
- Проверка на JavaScript инъекции
- Проверка на XSS паттерны
- Проверка кодировки (UTF-8, Latin-1)

## Валидация входных данных

### Имена файлов
- Проверка на path traversal (`..`, `/`, `\`)
- Проверка разрешенных символов
- Проверка зарезервированных имен (Windows)
- Максимальная длина: 255 символов
- Автоматическая очистка опасных символов

### Пути к файлам
- Проверка, что путь не выходит за пределы рабочей директории
- Нормализация путей
- Защита от directory traversal атак

### API Credentials
- Валидация API ID (положительное число, разумный диапазон)
- Валидация API Hash (формат, длина, символы)

### Прокси
- Валидация формата (`login:password@ip:port`)
- Проверка порта (1-65535)
- Проверка на опасные символы

### Данные кампаний
- Валидация названия (длина, символы)
- Валидация задержек (диапазоны, логика)
- Валидация времени работы
- Валидация идентификаторов чатов

## Безопасное хранение данных

### JSON файлы
- Атомарное сохранение (через временный файл)
- Валидация путей перед сохранением
- Обработка ошибок парсинга
- Защита от повреждения данных

### Логирование безопасности
- Все подозрительные действия логируются
- Логи включают хеши файлов, пути, ошибки
- Отдельные метки `[SECURITY]` для быстрого поиска

## Защита от атак

### Path Traversal
- Все пути валидируются
- Нормализация путей
- Проверка выхода за пределы рабочей директории

### Injection атаки
- Валидация всех входных данных
- Экранирование опасных символов
- Проверка на SQL injection паттерны (хотя используется JSON)

### XSS
- Валидация текстовых данных
- Проверка на JavaScript паттерны в файлах

## Рекомендации

1. **Регулярно проверяйте логи** (`bot.log`) на наличие меток `[SECURITY]`
2. **Не загружайте файлы из ненадёжных источников**
3. **Проверяйте хеши загруженных файлов** в логах
4. **Используйте только проверенные API credentials**
5. **Ограничьте доступ к боту** только доверенным пользователям

## Мониторинг

Все подозрительные действия автоматически логируются с меткой `[SECURITY]`:
- Попытки загрузки небезопасных файлов
- Невалидные входные данные
- Ошибки валидации
- Хеши загруженных файлов

Проверяйте `bot.log` регулярно для выявления потенциальных угроз.

